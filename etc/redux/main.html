<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Redux Basic</title>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.5/redux.min.js"
            integrity="sha512-P36ourTueX/PrXrD4Auc1kVLoTE7bkWrIrkaM0IG2X3Fd90LFgTRogpZzNBssay0XOXhrIgudf4wFeftdsPDiQ=="
            crossorigin="anonymous"
        ></script>
    </head>
    <body>
        <div id="subject"></div>
        <div id="toc"></div>
        <div id="control"></div>
        <div id="content"></div>

        <script>
            // Redux
            function reducer(state, action) {
                if (state === undefined) {
                    return {
                        selectedId: 1,
                        contents: [
                            { id: 1, title: 'HTML', desc: 'HTML is ...' },
                            { id: 2, title: 'CSS', desc: 'CSS is ...' },
                        ],
                    };
                }

                let newState = {};
                if (action.type === 'SELECT') {
                    newState = Object.assign({}, state, {
                        selectedId: action.id,
                    });
                }

                return newState;
            }
            const store = Redux.createStore(reducer);

            // title
            function subject() {
                document.querySelector('#subject').innerHTML = `
                <header>
                    <h1>WEB</h1>
                    <p>Hello, WEB!</p>
                </header>
                `;
            }

            // 목록
            // TOC: table of content
            function TOC() {
                const state = store.getState();

                let i = 0;
                let liTags = '';
                while (i < state.contents.length) {
                    liTags += `
                        <li><a href="${state.contents[i].id}.html" onclick="
                            event.preventDefault();
                            const action = {type:'SELECT', id: ${state.contents[i].id}};
                            store.dispatch(action);
                            ">${state.contents[i].title}</a></li>
                    `;
                    i = i + 1;
                }

                document.querySelector('#toc').innerHTML = `
                <nav>
                    <ol>
                        ${liTags}
                    </ol>
                </nav>
                `;
            }

            // 컨트롤 버튼들
            function control() {
                document.querySelector('#control').innerHTML = `
                <ul>
                    <li><a href="/create">create</a></li>
                    <li><input type="button" value="delete" /></li>
                </ul>
                `;
            }

            // 본문 내용
            function content() {
                const state = store.getState();

                let i = 0;
                let aTitle, aDesc;
                while (i < state.contents.length) {
                    if (state.contents[i].id === state.selectedId) {
                        aTitle = state.contents[i].title;
                        aDesc = state.contents[i].desc;
                        break;
                    }

                    i = i + 1;
                }

                document.querySelector('#content').innerHTML = `
                <article>
                    <h2>${aTitle}</h2>
                    <p>${aDesc}</p>
                </article>
                `;
            }

            // redux subscribe
            store.subscribe(content); // state가 바뀌면 UI 갱신되도록

            subject();
            TOC();
            control();
            content();
        </script>
    </body>
</html>
